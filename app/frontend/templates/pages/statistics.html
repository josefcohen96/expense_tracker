{% extends "layout/base.html" %}
{% block title %}סטטיסטיקות{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">סטטיסטיקות</h1>

<div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
  <!-- חודשי -->
  <section class="bg-white rounded-2xl shadow p-5 xl:col-span-2">
    <header class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">הוצאות 6 חודשים אחרונים</h2>
      <!-- קטגוריה סינון -->
      <div>
        <label for="monthly-category" class="mr-2">קטגוריה:</label>
        <select id="monthly-category" class="border rounded px-2 py-1">
          <option value="total">סה"כ</option>
          {% for cat in category_expenses %}
            <option value="{{ cat.category }}">{{ cat.category }}</option>
          {% endfor %}
        </select>
      </div>
    </header>
    <!-- שמים קונטיינר עם גובה קבוע וה-canvas מתרחב בתוכו -->
    <div class="relative h-72 md:h-80 xl:h-96">
      <canvas id="monthly-chart" class="absolute inset-0"></canvas>
    </div>
  </section>

  <!-- לפי משתמש -->
  <section class="bg-white rounded-2xl shadow p-5">
    <header class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">הוצאות לפי משתמש</h2>
    </header>
    <div class="relative h-72 md:h-80">
      <canvas id="user-chart" class="absolute inset-0"></canvas>
    </div>
  </section>

  <!-- לפי קטגוריה -->
  <section class="bg-white rounded-2xl shadow p-5 xl:col-span-3">
    <header class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">חלוקה לפי קטגוריה</h2>
      <!-- Month selector for category chart -->
      <div>
        <label for="donut-months" class="mr-2">חודש:</label>
        <select id="donut-months" class="border rounded px-2 py-1" multiple>
          {% for m in monthly_expenses %}
            <option value="{{ m.month }}">{{ m.month }}</option>
          {% endfor %}
        </select>
        <small>בחר חודש אחד או יותר</small>
      </div>
    </header>
    <div class="relative h-72 md:h-80 xl:h-96">
      <canvas id="donut-chart" class="absolute inset-0"></canvas>
    </div>
  </section>
</div>

<!-- נתוני JSON (כמו שיש לך כבר) -->
<script id="monthly-data" type="application/json">
  {{ (monthly_expenses | default([])) | tojson }}
</script>
<script id="user-data" type="application/json">
  {{ (user_expenses | default([])) | tojson }}
</script>
<script id="category-data" type="application/json">
  {{ (category_expenses | default([])) | tojson }}
</script>

<!-- ספריות -->
<script src="{{ url_for('static', path='js/vendor/chart.umd.min.js') }}"></script>
<script src="{{ url_for('static', path='js/vendor/htmx.min.js') }}"></script>

<!-- מודולים של הגרפים -->
<script type="module" src="{{ url_for('static', path='js/charts/helpers.js') }}"></script>
<script type="module" src="{{ url_for('static', path='js/charts/monthly.js') }}"></script>
<script type="module" src="{{ url_for('static', path='js/charts/user-bar.js') }}"></script>
<script type="module" src="{{ url_for('static', path='js/charts/donut.js') }}"></script>

<!-- Debug: show monthly_expenses as JSON -->
<pre>{{ monthly_expenses | tojson }}</pre>

{% endblock %}
